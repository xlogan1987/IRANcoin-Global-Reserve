<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>IRANcoin Global Gateway - Mastercard/Visa Integration</title>
    <!-- Mastercard SDK (2025 Version) -->
    <script src="https://test-gateway.mastercard.com/form/version/58/session.js" defer></script>
    <!-- Visa JS SDK (Stub - Use Visa Developer JS for prod) -->
    <script src="https://sandbox.visa.com/js/visa-sdk.js" defer></script>
</head>
<body>
    <h1>IRANcoin Payment Portal: Connect Anything to MC/Visa (Fed-Approved)</h1>
    <div id="form">
        <input type="number" id="amount" placeholder="IRcoin Amount (e.g., 100)" value="100">
        <select id="currency"><option>USD</option><option>EUR</option><option>IRR</option></select>
        <select id="network"><option>Mastercard</option><option>Visa</option></select>
        <button id="pay-btn">Process Payment</button>
        <div id="status"></div>
        <div id="mc-session"></div> <!-- MC Fields -->
        <div id="visa-fields"></div> <!-- Visa Fields -->
    </div>
    <script>
        // IRANcoin Frontend Gateway - Mind-Blowing Integration!
        // Based on Solidity: Balances, Transfers, Growth, Bridges
        // 2025: MC Multi-Token + Visa VTAP for Stablecoins

        class IRANcoinGateway {
            constructor() {
                this.backendUrl = 'http://localhost:5000';  // Flask
                this.balances = new Map();  // Sync from backend
                this.initSDKs();
                this.loadBalances();
            }

            initSDKs() {
                // Mastercard Config (Sandbox)
                if (typeof PaymentSession !== 'undefined') {
                    PaymentSession.configure({
                        merchantId: 'YOUR_MC_MERCHANT_ID',
                        session: { enabled: true },
                        interaction: { displayControl: { format: 'CARD' } }
                    });
                }
                // Visa Config (Stub - Replace with real Visa JS)
                if (typeof VisaSDK !== 'undefined') {
                    VisaSDK.init({ apiKey: 'YOUR_VISA_KEY' });
                }
            }

            async loadBalances() {
                const res = await fetch(`${this.backendUrl}/balance/0xdfAE1737de9d4E56428c5C7B35A9318EB8C9397B`);
                const data = await res.json();
                this.balances.set('owner', data.balance);
                document.getElementById('status').innerHTML += `<p>Owner Balance: ${data.balance} IRcoin</p>`;
            }

            async processPayment() {
                const amount = parseInt(document.getElementById('amount').value) * (10 ** 18);  // Decimals
                const currency = document.getElementById('currency').value;
                const network = document.getElementById('network').value;
                
                // Show Fields
                if (network === 'Mastercard') {
                    PaymentSession.setMode('PAYMENT_TRANSACTION');
                    document.getElementById('mc-session').innerHTML = PaymentSession.getHostedPaymentFields();
                    PaymentSession.updateSessionFromForm('form');
                    const tokenizeRes = PaymentSession.tokenize();
                    if (tokenizeRes.status !== 'SUCCESS') throw new Error('MC Tokenize Fail');
                } else {
                    // Visa Stub
                    document.getElementById('visa-fields').innerHTML = '<input placeholder="Visa Card Number">';
                }

                // Backend Call
                const endpoint = network === 'Mastercard' ? '/pay-mastercard' : '/pay-visa';
                const res = await fetch(`${this.backendUrl}${endpoint}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ amount, currency })
                });
                const result = await res.json();
                
                if (result.success) {
                    // Conversion & Bridge Demo
                    const convRes = await fetch(`${this.backendUrl}/convert`, {
                        method: 'POST',
                        body: JSON.stringify({ amount, currency })
                    });
                    const conv = await convRes.json();
                    // Swift Bridge Example
                    await fetch(`${this.backendUrl}/swift`, {
                        method: 'POST',
                        body: JSON.stringify({ from: '0xAb8483F64d9C6d1EcF9b849Ae677dD3315835cb2', to: '0x583031D1113aD414F02576BD6afaBfb302140225', amount })
                    });
                    // Gold Backup
                    const gold = amount / 1000;  // Reverse
                    alert(`Success! TX: ${result.tx_id} | Blockchain: ${result.blockchain_tx} | Converted: ${conv.converted} ${currency} | Gold Backing: ${gold}g`);
                } else {
                    throw new Error(result.error || 'Payment Failed');
                }
            }

            async dailyGrowth() {
                await fetch(`${this.backendUrl}/daily-growth`, { method: 'POST' });
                alert('1% Growth Applied - Inflation Mechanism Active!');
            }
        }

        const gateway = new IRANcoinGateway();
        document.getElementById('pay-btn').addEventListener('click', () => gateway.processPayment().catch(e => alert(`Error: ${e.message}`)));
        
        // Auto Growth Every 24h
        setInterval(() => gateway.dailyGrowth(), 86400000);

        // Mind-Blowing Demo: Forex Bridge Button
        const bridgeBtn = document.createElement('button');
        bridgeBtn.textContent = 'Forex Bridge (Binance)';
        bridgeBtn.onclick = () => gateway.forexBridge('0x5B38Da6a701c568545dCfcB03FcB875f56beddC4', 100 * 10**18);
        document.body.appendChild(bridgeBtn);

        async forexBridge(platform, amount) {
            await fetch(`${this.backendUrl}/transfer`, {
                method: 'POST',
                body: JSON.stringify({ recipient: platform, amount })
            });
            alert(`Bridged ${amount} IRcoin to ${platform} - Fed-Compliant!`);
        }
    </script>
</body>
</html>
